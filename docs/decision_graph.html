<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>decision_graph.py</title>
  <link rel="stylesheet" href="pycco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <div class='section'>
    <div class='docs'><h1>decision_graph.py</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">graph</span> <span class="kn">import</span> <span class="n">Graph</span><span class="p">,</span> <span class="n">Node</span>
<span class="kn">from</span> <span class="nn">channel</span> <span class="kn">import</span> <span class="n">Channel</span>
<span class="kn">from</span> <span class="nn">parser</span> <span class="kn">import</span> <span class="n">Parser</span>
<span class="kn">from</span> <span class="nn">procedures</span> <span class="kn">import</span> <span class="n">Procedures</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">copy</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">DecisionNode</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      <p>DecisionNode is inherited class from Node, 
   it contains logic required to perform decisions 
   on picking tasks and communication resources, 
   also stores propability.</p>
<p>Parameters</p>
<hr />
<p>label: int
       Node label for parent
   propability: float
       Number in range [0.1, 1] that represents how 
       many tasks will be affected by that node
   t_strategy: function reference
       Reference to function returning where to move task
   c_strategy: function reference
       Reference to function returning which comm to pick</p>
<p>Returns</p>
<hr />
<p>None</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">propability</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">t_strategy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">c_strategy</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_propability</span><span class="p">(</span><span class="n">propability</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">propability</span> <span class="o">=</span> <span class="n">propability</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connections</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">task_strategy</span> <span class="o">=</span> <span class="n">t_strategy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comm_strategy</span> <span class="o">=</span> <span class="n">c_strategy</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">check_propability</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">propability</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">propability</span> <span class="o">&gt;=</span> <span class="mf">0.01</span>
        <span class="k">assert</span> <span class="n">propability</span> <span class="o">&lt;=</span> <span class="mf">1.0</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;DecisionNode:</span><span class="se">\n</span><span class="s2"> label &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> propability: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">propability</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">DecisionGraph</span><span class="p">(</span><span class="n">Graph</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-7'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-7'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-8'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-8'>#</a>
      </div>
      <p>Static method performing crossover on two 
   graphs and returning two children after that 
   operation</p>
<p>Parameters</p>
<hr />
<p>parent_1: DecisionGraph
       First parent to perform crossover on
   parent_2: DecisionGraph
       Second parent to perform crossover on</p>
<p>Returns</p>
<hr />
<p>DecisionGraph
       First child
   DecisionGraph
       Second child</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">crossover</span><span class="p">(</span><span class="n">parent_1</span><span class="p">:</span> <span class="n">DecisionGraph</span><span class="p">,</span> <span class="n">parent_2</span><span class="p">:</span> <span class="n">DecisionGraph</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">DecisionGraph</span><span class="p">,</span> <span class="n">DecisionGraph</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-9'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-9'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-10'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-10'>#</a>
      </div>
      <p>Adding new nodes to graph could cause labels conflicts. 
To avoid that new nodes are added with labels beginning from offset.
In the end all labels in graphs are reassigned to be in order and again below offset</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">offset</span> <span class="o">=</span> <span class="mi">1000</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parent_1</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">parent_2</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">parent_1</span><span class="p">,</span> <span class="n">parent_2</span>

        <span class="n">child_1</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">parent_1</span><span class="p">)</span>
        <span class="n">child_2</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">parent_2</span><span class="p">)</span>
        <span class="n">point1n</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">child_1</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">point2n</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">child_2</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">point1</span> <span class="o">=</span> <span class="n">point1n</span><span class="o">.</span><span class="n">label</span>
        <span class="n">point2</span> <span class="o">=</span> <span class="n">point2n</span><span class="o">.</span><span class="n">label</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;points: &quot;</span><span class="p">,</span> <span class="n">point1</span><span class="p">,</span> <span class="n">point2</span><span class="p">)</span>

        <span class="n">g1_parents</span> <span class="o">=</span> <span class="n">child_1</span><span class="o">.</span><span class="n">find_parents</span><span class="p">(</span><span class="n">point1</span><span class="p">)</span>
        <span class="n">g2_parents</span> <span class="o">=</span> <span class="n">child_2</span><span class="o">.</span><span class="n">find_parents</span><span class="p">(</span><span class="n">point2</span><span class="p">)</span>

        <span class="n">g1_children_labels</span> <span class="o">=</span> <span class="n">child_1</span><span class="o">.</span><span class="n">get_all_children</span><span class="p">(</span><span class="n">point1</span><span class="p">)</span>
        <span class="n">g2_children_labels</span> <span class="o">=</span> <span class="n">child_2</span><span class="o">.</span><span class="n">get_all_children</span><span class="p">(</span><span class="n">point2</span><span class="p">)</span>

        <span class="n">g1_children</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">([</span><span class="n">child_1</span><span class="o">.</span><span class="n">find_node</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">g1_children_labels</span><span class="p">])</span>
        <span class="n">g2_children</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">([</span><span class="n">child_2</span><span class="o">.</span><span class="n">find_node</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">g2_children_labels</span><span class="p">])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-11'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-11'>#</a>
      </div>
      <p>Remove nodes from source graphs</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">child_1</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">point1</span><span class="p">)</span>
        <span class="n">child_2</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">point2</span><span class="p">)</span>

        <span class="n">child_1</span><span class="o">.</span><span class="n">remove_nodes</span><span class="p">(</span><span class="n">g1_children_labels</span><span class="p">)</span>
        <span class="n">child_2</span><span class="o">.</span><span class="n">remove_nodes</span><span class="p">(</span><span class="n">g2_children_labels</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-12'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-12'>#</a>
      </div>
      <p>Add nodes to destination graphs</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">child_1</span><span class="o">.</span><span class="n">add_real_node</span><span class="p">(</span><span class="n">DecisionNode</span><span class="p">(</span> <span class="n">point2</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> \
                                            <span class="n">point2n</span><span class="o">.</span><span class="n">propability</span><span class="p">,</span> \
                                            <span class="n">point2n</span><span class="o">.</span><span class="n">task_strategy</span><span class="p">,</span> \
                                            <span class="n">point2n</span><span class="o">.</span><span class="n">comm_strategy</span><span class="p">))</span>

        <span class="n">child_2</span><span class="o">.</span><span class="n">add_real_node</span><span class="p">(</span><span class="n">DecisionNode</span><span class="p">(</span>  <span class="n">point1</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> \
                                        <span class="n">point1n</span><span class="o">.</span><span class="n">propability</span><span class="p">,</span> \
                                        <span class="n">point1n</span><span class="o">.</span><span class="n">task_strategy</span><span class="p">,</span> \
                                        <span class="n">point1n</span><span class="o">.</span><span class="n">comm_strategy</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">g2_children</span><span class="p">:</span>
            <span class="n">child_1</span><span class="o">.</span><span class="n">add_real_node</span><span class="p">(</span><span class="n">DecisionNode</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">label</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">propability</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">task_strategy</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">comm_strategy</span><span class="p">))</span>
        
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">g1_children</span><span class="p">:</span>
            <span class="n">child_2</span><span class="o">.</span><span class="n">add_real_node</span><span class="p">(</span><span class="n">DecisionNode</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">label</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">propability</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">task_strategy</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">comm_strategy</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-13'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-13'>#</a>
      </div>
      <p>Add connections from parents to added nodes</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">g1_parents</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">g1_parents</span><span class="p">:</span>
                <span class="n">child_1</span><span class="o">.</span><span class="n">add_connection</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">point2</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">g2_parents</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">g2_parents</span><span class="p">:</span>
                <span class="n">child_2</span><span class="o">.</span><span class="n">add_connection</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">point1</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-14'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-14'>#</a>
      </div>
      <p>Add connections from added node to it&rsquo;s children</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">point1n</span><span class="o">.</span><span class="n">neighbours</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">child_2</span><span class="o">.</span><span class="n">add_connection</span><span class="p">(</span><span class="n">point1</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">label</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">point2n</span><span class="o">.</span><span class="n">neighbours</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">child_1</span><span class="o">.</span><span class="n">add_connection</span><span class="p">(</span><span class="n">point2</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">label</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-15'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-15'>#</a>
      </div>
      <p>Add all connections between added children</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">g1_children</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">neigh</span> <span class="ow">in</span> <span class="n">child</span><span class="o">.</span><span class="n">neighbours</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">child_2</span><span class="o">.</span><span class="n">add_connection</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">label</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="n">neigh</span><span class="o">.</span><span class="n">label</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">g2_children</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">neigh</span> <span class="ow">in</span> <span class="n">child</span><span class="o">.</span><span class="n">neighbours</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">child_1</span><span class="o">.</span><span class="n">add_connection</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">label</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="n">neigh</span><span class="o">.</span><span class="n">label</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-16'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-16'>#</a>
      </div>
      <p>Recalculate labels</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">child_1</span><span class="o">.</span><span class="n">nodes</span><span class="p">):</span>
            <span class="n">n</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">i</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">child_2</span><span class="o">.</span><span class="n">nodes</span><span class="p">):</span>
            <span class="n">n</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">i</span>

        <span class="k">return</span> <span class="n">child_1</span><span class="p">,</span> <span class="n">child_2</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-17'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-17'>#</a>
      </div>
      <p>Static method that mutates graph</p>
<p>Parameters</p>
<hr />
<p>graph: DecisionGraph
       Graph to perform mutation on</p>
<p>Returns</p>
<hr />
<p>DecisionGraph
       Mutated graph</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">mutate</span><span class="p">(</span><span class="n">graph</span><span class="p">:</span> <span class="n">DecisionGraph</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DecisionGraph</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-18'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-18'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">random_node</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">random_node</span><span class="o">.</span><span class="n">task_strategy</span> <span class="o">=</span> <span class="n">Procedures</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">get_oper</span><span class="p">()</span>
        <span class="n">random_node</span><span class="o">.</span><span class="n">comm_strategy</span> <span class="o">=</span> <span class="n">Procedures</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">get_comm</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">graph</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-19'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-19'>#</a>
      </div>
      <p>Static method that creates random graph with 
   no dangling nodes.</p>
<p>Parameters</p>
<hr />
<p>count: int
       Number of nodes that graph will have</p>
<p>Returns</p>
<hr />
<p>DecisionGraph
       Randomly generated graph with no 
       dangling nodes</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">create_random_graph</span><span class="p">(</span><span class="n">count</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DecisionGraph</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-20'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-20'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">connected</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dg</span> <span class="o">=</span> <span class="n">DecisionGraph</span><span class="p">()</span>
        <span class="n">pr</span> <span class="o">=</span> <span class="n">Procedures</span><span class="o">.</span><span class="n">instance</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-21'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-21'>#</a>
      </div>
      <p>Add root node with propability 1</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">dg</span><span class="o">.</span><span class="n">add_real_node</span><span class="p">(</span><span class="n">DecisionNode</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">pr</span><span class="o">.</span><span class="n">get_oper</span><span class="p">(),</span> <span class="n">pr</span><span class="o">.</span><span class="n">get_comm</span><span class="p">()))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-22'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-22'>#</a>
      </div>
      <p>Add count - 1 nodes (root already added)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
            <span class="n">dg</span><span class="o">.</span><span class="n">add_real_node</span><span class="p">(</span><span class="n">DecisionNode</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.9</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">),</span> <span class="n">pr</span><span class="o">.</span><span class="n">get_oper</span><span class="p">(),</span> <span class="n">pr</span><span class="o">.</span><span class="n">get_comm</span><span class="p">()))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-23'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-23'>#</a>
      </div>
      <p>Connect nodes avoiding dangling nodes</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">dg</span><span class="o">.</span><span class="n">add_connection</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">connected</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">dg</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">label</span> <span class="ow">in</span> <span class="n">connected</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dest</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">connected</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="s2">&quot; -&gt; &quot;</span><span class="p">,</span> <span class="n">dest</span><span class="p">)</span>
                    <span class="n">dg</span><span class="o">.</span><span class="n">add_connection</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">connected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">dg</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-24'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-24'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">add_real_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">DecisionNode</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">o_props</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>
    <span class="n">c_props</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">]</span>
    <span class="n">Procedures</span><span class="p">(</span><span class="n">Parser</span><span class="o">.</span><span class="n">instance</span><span class="p">,</span> <span class="n">o_props</span><span class="p">,</span> <span class="n">c_props</span><span class="p">)</span>
    
    <span class="n">dg1</span> <span class="o">=</span> <span class="n">DecisionGraph</span><span class="p">()</span>
    <span class="n">dg1</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">dg1</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">dg1</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">dg1</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">dg1</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">dg1</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">dg1</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
    <span class="n">dg1</span><span class="o">.</span><span class="n">add_connection</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">dg1</span><span class="o">.</span><span class="n">add_connection</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">dg1</span><span class="o">.</span><span class="n">add_connection</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">dg1</span><span class="o">.</span><span class="n">add_connection</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">dg1</span><span class="o">.</span><span class="n">add_connection</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">dg1</span><span class="o">.</span><span class="n">add_connection</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">dg2</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">dg1</span><span class="p">)</span>
    <span class="n">g1</span> <span class="o">=</span> <span class="n">DecisionGraph</span><span class="o">.</span><span class="n">mutate</span><span class="p">(</span><span class="n">dg1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">g1</span><span class="p">)</span>
    <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span> <span class="o">=</span> <span class="n">DecisionGraph</span><span class="o">.</span><span class="n">crossover</span><span class="p">(</span><span class="n">dg1</span><span class="p">,</span> <span class="n">dg2</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">g1</span><span class="p">)</span>
    <span class="nb">print</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">g2</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-25'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-25'>#</a>
      </div>
      <p>print(len(graph.nodes))</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>
